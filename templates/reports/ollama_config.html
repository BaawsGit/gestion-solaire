{% extends 'base/base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">{{ page_title }}</h1>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Configuration Ollama</h6>
                </div>
                <div class="card-body">
                    <!-- Statut de connexion -->
                    <div class="alert alert-{% if connection.success %}success{% else %}danger{% endif %} mb-4">
                        <h5>
                            <i class="fas fa-{% if connection.success %}check-circle{% else %}times-circle{% endif %}"></i>
                            {{ connection.message }}
                        </h5>
                        {% if connection.success %}
                            <p class="mb-0">
                                <strong>URL:</strong> {{ connection.url }}<br>
                                <strong>Modèle configuré:</strong> {{ connection.model }}<br>
                                <strong>Modèles disponibles:</strong> {{ connection.models|join:", " }}
                            </p>
                        {% endif %}
                    </div>

                    <!-- Formulaire de configuration -->
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="form-group">
                            <label for="base_url">URL du serveur Ollama</label>
                            <input type="text" class="form-control" id="base_url" 
                                   name="base_url" value="{{ current_url }}"
                                   placeholder="http://localhost:11434">
                            <small class="form-text text-muted">
                                L'URL où tourne le serveur Ollama (par défaut: http://localhost:11434)
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="model_name">Modèle à utiliser</label>
                            <select class="form-control" id="model_name" name="model_name">
                                {% for model in available_models %}
                                    <option value="{{ model }}" {% if model == current_model %}selected{% endif %}>
                                        {{ model }}
                                    </option>
                                {% empty %}
                                    <option value="phi3">phi3 (recommandé - rapide)</option>
                                    <option value="gemma3:4b">gemma3:4b</option>
                                    <option value="llama3.1:8b">llama3.1:8b</option>
                                    <option value="mistral">mistral</option>
                                {% endfor %}
                            </select>
                            <small class="form-text text-muted">
                                <strong>Recommandations:</strong><br>
                                • <code>phi3</code> (1.5GB) - Très rapide, bon pour les petits rapports<br>
                                • <code>gemma3:4b</code> (4GB) - Rapide et intelligent<br>
                                • <code>llama3.1:8b</code> (8GB) - Plus précis mais plus lent
                            </small>
                        </div>
                        
                        <div class="alert alert-info">
                            <h6><i class="fas fa-lightbulb"></i> Conseil</h6>
                            <p class="mb-0">
                                Si vous avez des timeouts fréquents, choisissez un modèle plus léger comme <code>phi3</code>.
                                Téléchargez-le avec: <code>ollama pull phi3</code>
                            </p>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Enregistrer la configuration
                        </button>
                        <a href="{% url 'reports:test_connection' %}" class="btn btn-info ml-2">
                            <i class="fas fa-plug"></i> Tester la connexion
                        </a>
                        <a href="{% url 'reports:report_list' %}" class="btn btn-secondary ml-2">
                            <i class="fas fa-arrow-left"></i> Retour
                        </a>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Guide d'installation rapide</h6>
                </div>
                <div class="card-body">
                    <h6>1. Installation d'Ollama:</h6>
                    <pre class="bg-dark text-light p-2 rounded">
# Windows (télécharger depuis https://ollama.com/)
# Linux/Mac
curl -fsSL https://ollama.com/install.sh | sh</pre>
                    
                    <h6 class="mt-3">2. Télécharger un modèle:</h6>
                    <pre class="bg-dark text-light p-2 rounded">
# Modèle rapide (recommandé)
ollama pull phi3

# Modèle équilibré
ollama pull gemma3:4b

# Modèle complet
ollama pull llama3.1:8b</pre>
                    
                    <h6 class="mt-3">3. Lancer le serveur:</h6>
                    <pre class="bg-dark text-light p-2 rounded">
# Dans un terminal séparé
ollama serve</pre>
                    
                    <h6 class="mt-3">4. Vérifier l'installation:</h6>
                    <pre class="bg-dark text-light p-2 rounded">
ollama list
ollama ps</pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}